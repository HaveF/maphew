#@+leo-ver=5-thin
#@+node:maphew.20121011215813.1567: * @file Notes.txt

#@+others
#@+node:maphew.20130122175214.1530: ** bugs
#@+node:maphew.20130122175214.1531: *3* a2 install bad-pkg-name
todo: Have apt report nicely when the packagename is not recognized

B:\code\maphew\apt>a2 install iconvcurl
---------- running apt install iconvcurl
Traceback (most recent call last):
  File "a2.py", line 84, in <module>
    for out in plac.call(main): print(out)
  File "b:\o4w\apps\Python27\lib\site-packages\plac_core.py", line 309, in call
    cmd, result = parser_from(obj).consume(arglist)
  File "b:\o4w\apps\Python27\lib\site-packages\plac_core.py", line 195, in consu
me
    return cmd, self.func(*(args + varargs + extraopts), **kwargs)
  File "a2.py", line 47, in install
    apt.install(packages)
  File "B:\code\maphew\apt\apt.py", line 190, in install
    missing.update (dict (map (lambda x: (x, 0), get_missing (packagename))))
  File "B:\code\maphew\apt\apt.py", line 652, in get_missing
    reqs = get_requires (packagename)
  File "B:\code\maphew\apt\apt.py", line 738, in get_requires
    no_package ('warning')
  File "B:\code\maphew\apt\apt.py", line 913, in no_package
    sys.stderr.write ("%s: %s not in [%s]\n" % (s, packagename, distname))
NameError: global name 'packagename' is not defined
#@+node:maphew.20121113004545.1578: ** a2
I've done pretty good so far, using the a2 wrapper to slowly go over apt and piece by piece move procedural code into functions, and still keep both programs working. I'm nearing the end of the easy stuff though, and now the mass of globals in a2 are starting to get in the way.

The problem of the moment is that check for the O4W root takes place before plac, so all that nice help formatting goes right out the window, yet *not* doing the check means we get a key error when processing the globals:

    B:\code\maphew\apt>a2
    Traceback (most recent call last):
      File "a2.py", line 11, in <module>
        apt.OSGEO4W_ROOT = os.environ['OSGEO4W_ROOT']
      File "B:\o4w\\apps\Python27\lib\os.py", line 423, in __getitem__
        return self.data[key.upper()]
    KeyError: 'OSGEO4W_ROOT'

sigh.

This may mean the end of moving apt furniture about. We've tidied things up, there's some organization, but to go any further means ripping some walls out and moving structural elements. It could all come crashing down next, but hey! that's why we're using version control with smart and easy merging and branching, right? 

(now if only I knew how to use it! :)
#@+node:maphew.20121011215813.1569: ** Expected test results
#@+node:maphew.20121113004545.1562: *3* apt setup
B:\code\maphew\apt>apt setup
Root dir not found, creating d:/temp/o4w_2012-nov-11
creating d:/temp/o4w_2012-nov-11/etc/setup/
creating d:/temp/o4w_2012-nov-11/etc/setup//installed.db
getting d:/temp/o4w_2012-nov-11/etc/setup//setup.ini
...100%
#@+node:maphew.20121113004545.1561: *3* a2 setup
B:\code\maphew\apt>a2 setup path\as\param\not\yet\working
Error retreiving installed package info. Has "apt setup" been run yet?

---------- running apt setup
Root dir not found, creating d:\temp\o4w_2012-nov-11
creating d:\temp\o4w_2012-nov-11/etc/setup/
creating d:\temp\o4w_2012-nov-11/etc/setup//installed.db
getting d:\temp\o4w_2012-nov-11/etc/setup//setup.ini
...100%  ----------setup
#@+node:maphew.20121011215813.1573: *3* apt update
B:\code\maphew\apt>apt update
...100%
#@+node:maphew.20121011215813.1574: *3* a2 update
B:\code\maphew\apt>a2 update
---------- running apt update None
...100%  ----------Update finished
#@+node:maphew.20121011215813.1568: *3* apt install iconv curl
B:\code\maphew\apt>apt install iconv curl
to install:
    iconv curl

iconv = d:/temp/o4w-cache/setup/http%3a%2f%2fdownload.osgeo.org%2fosgeo4w/./rele
ase/iconv/iconv-1.9.1-1.tar.bz2

b9f7db00b8fd33a5fe821788b1029791  iconv-1.9.1-1.tar.bz2 - remote
b9f7db00b8fd33a5fe821788b1029791  iconv-1.9.1-1.tar.bz2 - local

curl = d:/temp/o4w-cache/setup/http%3a%2f%2fdownload.osgeo.org%2fosgeo4w/./relea
se/curl/curl-7.15.1-2.tar.bz2

97327843d4f00ec70bd08739336083c9  curl-7.15.1-2.tar.bz2 - remote
97327843d4f00ec70bd08739336083c9  curl-7.15.1-2.tar.bz2 - local
installing iconv 1.9.1-1
installing curl 7.15.1-2
#@+node:maphew.20121011215813.1571: *3* a2 install iconv curl
B:\code\maphew\apt>a2 install iconv curl
---------- running apt install iconv curl
to install:
    iconv curl

iconv = d:/temp/o4w-cache/setup/http%3a%2f%2fdownload.osgeo.org%2fosgeo4w/./rele
ase/iconv/iconv-1.9.1-1.tar.bz2

b9f7db00b8fd33a5fe821788b1029791  iconv-1.9.1-1.tar.bz2 - remote
b9f7db00b8fd33a5fe821788b1029791  iconv-1.9.1-1.tar.bz2 - local

curl = d:/temp/o4w-cache/setup/http%3a%2f%2fdownload.osgeo.org%2fosgeo4w/./relea
se/curl/curl-7.15.1-2.tar.bz2

97327843d4f00ec70bd08739336083c9  curl-7.15.1-2.tar.bz2 - remote
97327843d4f00ec70bd08739336083c9  curl-7.15.1-2.tar.bz2 - local
installing iconv 1.9.1-1
installing curl 7.15.1-2
---------- Install complete
#@+node:maphew.20121011215813.1570: *3* apt remove iconv curl
B:\code\maphew\apt>apt remove iconv curl
iconv
removing iconv 1.9.1-1
removed: O:\bin\iconv.dll
removed: O:\include\iconv.h
removed: O:\lib\iconv.lib
curl
removing curl 7.15.1-2
removed: O:\bin\curl.exe
removed: O:\bin\libcurl.dll
removed: O:\bin\zlib1.dll
removed: O:\include\curl\curl.h
removed: O:\include\curl\curlver.h
removed: O:\include\curl\easy.h
removed: O:\include\curl\mprintf.h
removed: O:\include\curl\multi.h
removed: O:\include\curl\stdcheaders.h
removed: O:\include\curl\types.h
removed: O:\lib\libcurl_imp.lib
#@+node:maphew.20121011215813.1572: *3* a2 remove iconv curl
B:\code\maphew\apt>a2 remove iconv curl
---------- running apt remove iconv curl
iconv
removing iconv 1.9.1-1
removed: O:\bin\iconv.dll
removed: O:\include\iconv.h
removed: O:\lib\iconv.lib
curl
removing curl 7.15.1-2
removed: O:\bin\curl.exe
removed: O:\bin\libcurl.dll
removed: O:\bin\zlib1.dll
removed: O:\include\curl\curl.h
removed: O:\include\curl\curlver.h
removed: O:\include\curl\easy.h
removed: O:\include\curl\mprintf.h
removed: O:\include\curl\multi.h
removed: O:\include\curl\stdcheaders.h
removed: O:\include\curl\types.h
removed: O:\lib\libcurl_imp.lib
---------- Remove complete
#@-others
#@-leo
